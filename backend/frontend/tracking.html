<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- JavaScript (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>Hexashop - Track Your Order</title>

    <!-- Additional CSS Files -->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/templatemo-hexashop.css">
    <link rel="stylesheet" href="assets/css/owl-carousel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css">
     <link rel="stylesheet" href="assets/css/tracking.css">


    <style>
        
        /* Custom banner for tracking page */
        .page-heading {
            background-image: url('https://i.ibb.co/Hw6VF2R/tracking.jpg') !important;
            background-position: center center !important;
            background-size: cover !important;
            background-repeat: no-repeat !important;
            padding: 15px 0 !important;
            margin: 10px 0 25px 0 !important;
        }
        
        /* Fallback banner color if image doesn't exist */
        .page-heading {
            background-color: #f8f9fa !important;
        }
        
        @media (max-width: 768px) {
            .order-details {
                grid-template-columns: 1fr;
            }
            
            .phone-input-group {
                flex-direction: column;
            }
            
            .phone-input-group input {
                border-radius: 4px;
                margin-bottom: 10px;
            }
            
            .phone-input-group button {
                border-radius: 4px;
                padding: 12px;
            }
            
            .order-header {
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->

    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="index.html" class="logo">
                            <img src="med/logo3.png" alt="Hexashop Logo" class="img-fluid" style="height: 75px; width: auto;">
                        </a>
                        <!-- ***** Logo End ***** -->
                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li class="scroll-to-section"><a href="index.html">Home</a></li>
                            <li class="scroll-to-section"><a href="index.html#men">Men</a></li>
                            <li class="scroll-to-section"><a href="index.html#women">Women</a></li>
                            <li class="scroll-to-section"><a href="index.html#kids">Kids</a></li>
                            <li class="submenu">
                                <a href="javascript:;">Pages</a>
                                <ul>
                                    <li><a href="index.html#brands" class="scroll-to-section">Our Brands</a></li> 
                                    <li><a href="tracking.html">Tracking/Order history</a></li>
                                    <li><a href="about.html">About Us</a></li>
                                    <li><a href="contact.html">Contact Us</a></li>
                                </ul>
                            </li>
                            <li class="scroll-to-section"><a href="cart.html"><i class="fa fa-shopping-cart"></i> Cart</a></li>
                            <li class="scroll-to-section"><a href="tracking.html" class="active"><i class="fa fa-truck"></i> Track Order</a></li>
                        </ul>
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                        <!-- ***** Menu End ***** -->
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <!-- ***** Main Banner Area Start ***** -->
    <div class="page-heading" id="top">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="inner-content">
                        <h2>Track Your Order</h2>
                        <span>Enter your phone number to view order status and tracking information</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ***** Main Banner Area End ***** -->

    <!-- ***** Tracking Section Starts ***** -->
    <section class="tracking-section">
        <div class="container">
            <div class="phone-input-section">
                <h3>Enter Your Phone Number</h3>
                <div id="alert-message" class="alert-message"></div>
                <div class="phone-input-group">
                    <input type="text" id="phone-input" placeholder="+213 XX XX XX XXX" maxlength="50">
                    <button id="track-order-btn">
                        <span id="track-button-text">Track Order</span>
                        <span id="track-button-spinner" class="loading-spinner" style="display: none;"></span>
                    </button>
                </div>
            </div>
            
            <div id="orders-container">
                <!-- Orders will be loaded here dynamically -->
                <div class="no-orders">
                    <i class="fa fa-search"></i>
                    <h3>No Orders Found</h3>
                    <p>Enter your phone number to view your order history and tracking information.</p>
                </div>
            </div>
        </div>
    </section>
    <!-- ***** Tracking Section Ends ***** -->

    <!-- ***** Footer Start ***** -->
<footer style="background-color: #2a2a2a;" class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-12 d-flex flex-column align-items-center">
                
                <nav class="footer-nav mb-4 d-flex flex-wrap justify-content-center gap-4">
                    <a href="index.html" class="text-white text-decoration-none px-2">Home</a>
                    <a href="about.html" class="text-white text-decoration-none px-2">About</a>
                    <a href="products.html" class="text-white text-decoration-none px-2">Products</a>
                    <a href="contact.html" class="text-white text-decoration-none px-2">Contact</a>
                </nav>

                <div class="mb-4 d-flex gap-3">
                    <a href="#" class="btn btn-outline-light rounded-circle footer-social-btn">
                        <i class="fa-brands fa-facebook-f"></i>
                        <span class="visually-hidden">Facebook</span>
                    </a>
                    <a href="https://www.instagram.com" class="btn btn-outline-light rounded-circle footer-social-btn">
                        <i class="fa-brands fa-instagram"></i>
                        <span class="visually-hidden">Instagram</span>
                    </a>
                    <a href="#" class="btn btn-outline-light rounded-circle footer-social-btn">
                        <i class="fa-brands fa-tiktok"></i>
                        <span class="visually-hidden">Tiktok</span>
                    </a>
                </div>

                <div class="text-center">
                    <p class="small text-white-50 mb-0">
                        Copyright © 2023 Hexashop Co., Ltd. All Rights Reserved.
                    </p>
                </div>
            </div>
        </div>
    </div>
</footer>

    <!-- =========================================
       BOTTOM MOBILE NAVIGATION BAR (SAME AS INDEX.HTML)
       ========================================= -->
    <div class="mobile-bottom-nav">
        <!-- Home -->
        <a href="index.html" class="nav-item">
            <svg class="icon icon-home icon-sm" width="20" height="20" viewBox="0 0 20 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" d="M18.3337 14.1667V10.4538C18.3337 9.09868 18.3337 8.42113 18.1681 7.79394C18.006 7.17971 17.7284 6.602 17.35 6.09172C16.9637 5.57066 16.4346 5.1474 15.3764 4.30088L14.9979 3.99805L14.9979 3.99804C13.2143 2.57117 12.3225 1.85774 11.3335 1.58413C10.4611 1.34279 9.53956 1.34279 8.66717 1.58413C7.67815 1.85774 6.78636 2.57118 5.00277 3.99805L5.00276 3.99805L4.62423 4.30088C3.56607 5.1474 3.037 5.57066 2.65064 6.09172C2.27227 6.602 1.99461 7.17971 1.83251 7.79394C1.66699 8.42113 1.66699 9.09868 1.66699 10.4538V14.1667C1.66699 16.4679 3.53247 18.3333 5.83366 18.3333C6.75413 18.3333 7.50033 17.5871 7.50033 16.6667V13.3333C7.50033 11.9526 8.61961 10.8333 10.0003 10.8333C11.381 10.8333 12.5003 11.9526 12.5003 13.3333V16.6667C12.5003 17.5871 13.2465 18.3333 14.167 18.3333C16.4682 18.3333 18.3337 16.4679 18.3337 14.1667Z"/>
            </svg>
            <span>Home</span>
        </a>
        
        <!-- Menu -->
        <a href="javascript:void(0);" class="nav-item menu-trigger-bottom">
            <svg class="icon icon-hamburger icon-sm" width="20" height="20" viewBox="0 0 21 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.2002 5H18.2002M3.2002 10H9.86686M3.2002 15H14.0335"/>
            </svg>
            <span>Menu</span>
        </a>
        
        <!-- Shop -->
        <a href="products.html" class="nav-item">
            <svg class="icon icon-grid icon-sm" width="20" height="20" viewBox="0 0 21 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" d="M1.7666 4.8665C1.7666 3.7464 1.7666 3.18635 1.98459 2.75852C2.17634 2.3822 2.4823 2.07624 2.85862 1.88449C3.28644 1.6665 3.8465 1.6665 4.9666 1.6665H5.23327C6.35337 1.6665 6.91343 1.6665 7.34125 1.88449C7.71757 2.07624 8.02353 2.3822 8.21528 2.75852C8.43327 3.18635 8.43327 3.7464 8.43327 4.8665V5.13317C8.43327 6.25328 8.43327 6.81333 8.21528 7.24115C8.02353 7.61748 7.71757 7.92344 7.34125 8.11518C6.91343 8.33317 6.35337 8.33317 5.23327 8.33317H4.9666C3.8465 8.33317 3.28644 8.33317 2.85862 8.11518C2.4823 7.92344 2.17634 7.61748 1.98459 7.24115C1.7666 6.81333 1.7666 6.25328 1.7666 5.13317V4.8665Z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.7666 4.8665C11.7666 3.7464 11.7666 3.18635 11.9846 2.75852C12.1763 2.3822 12.4823 2.07624 12.8586 1.88449C13.2864 1.6665 13.8465 1.6665 14.9666 1.6665H15.2333C16.3534 1.6665 16.9134 1.6665 17.3413 1.88449C17.7176 2.07624 18.0235 2.3822 18.2153 2.75852C18.4333 3.18635 18.4333 3.7464 18.4333 4.8665V5.13317C18.4333 6.25328 18.4333 6.81333 18.2153 7.24115C18.0235 7.61748 17.7176 7.92344 17.3413 8.11518C16.9134 8.33317 16.3534 8.33317 15.2333 8.33317H14.9666C13.8465 8.33317 13.2864 8.33317 12.8586 8.11518C12.4823 7.92344 12.1763 7.61748 11.9846 7.24115C11.7666 6.81333 11.7666 6.25328 11.7666 5.13317V4.8665Z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M1.7666 14.8665C1.7666 13.7464 1.7666 13.1863 1.98459 12.7585C2.17634 12.3822 2.4823 12.0762 2.85862 11.8845C3.28644 11.6665 3.8465 11.6665 4.9666 11.6665H5.23327C6.35337 11.6665 6.91343 11.6665 7.34125 11.8845C7.71757 12.0762 8.02353 12.3822 8.21528 12.7585C8.43327 13.1863 8.43327 13.7464 8.43327 14.8665V15.1332C8.43327 16.2533 8.43327 16.8133 8.21528 17.2412C8.02353 17.6175 7.71757 17.9234 7.34125 18.1152C6.91343 18.3332 6.35337 18.3332 5.23327 18.3332H4.9666C3.8465 18.3332 3.28644 18.3332 2.85862 18.1152C2.4823 17.9234 2.17634 17.6175 1.98459 17.2412C1.7666 16.8133 1.7666 16.2533 1.7666 15.1332V14.8665Z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.7666 14.8665C11.7666 13.7464 11.7666 13.1863 11.9846 12.7585C12.1763 12.3822 12.4823 12.0762 12.8586 11.8845C13.2864 11.6665 13.8465 11.6665 14.9666 11.6665H15.2333C16.3534 11.6665 16.9134 11.6665 17.3413 11.8845C17.7176 12.0762 18.0235 12.3822 18.2153 12.7585C18.4333 13.1863 18.4333 13.7464 18.4333 14.8665V15.1332C18.4333 16.2533 18.4333 16.8133 18.2153 17.2412C18.0235 17.6175 17.7176 17.9234 17.3413 18.1152C16.9134 18.3332 16.3534 18.3332 15.2333 18.3332H14.9666C13.8465 18.3332 13.2864 18.3332 12.8586 18.1152C12.4823 17.9234 12.1763 17.6175 11.9846 17.2412C11.7666 16.8133 11.7666 16.2533 11.7666 15.1332V14.8665Z"/>
            </svg>
            <span>Shop</span>
        </a>
        
        <!-- Cart -->
        <a href="cart.html" class="nav-item">
            <svg class="icon icon-cart icon-sm" width="20" height="20" viewBox="0 0 20 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" d="M1.66667 1.66667H3.33333L5.83333 11.6667H16.6667L18.3333 4.16667H5.83333M5.83333 15.8333C5.83333 16.7538 6.57953 17.5 7.5 17.5C8.42047 17.5 9.16667 16.7538 9.16667 15.8333C9.16667 14.9129 8.42047 14.1667 7.5 14.1667C6.57953 14.1667 5.83333 14.9129 5.83333 15.8333ZM14.1667 15.8333C14.1667 16.7538 14.9129 17.5 15.8333 17.5C16.7538 17.5 17.5 16.7538 17.5 15.8333C17.5 14.9129 16.7538 14.1667 15.8333 14.1667C14.9129 14.1667 14.1667 14.9129 14.1667 15.8333Z"/>
            </svg>
            <span>Cart</span>
        </a>
        
        <!-- Tracking -->
        <a href="tracking.html" class="nav-item active">
            <svg class="icon icon-tracking icon-sm" width="20" height="20" viewBox="0 0 20 20" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 18.3333C10 18.3333 17.5 12.5 17.5 8.33333C17.5 4.16667 14.1667 0.833333 10 0.833333C5.83333 0.833333 2.5 4.16667 2.5 8.33333C2.5 12.5 10 18.3333 10 18.3333Z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 10.8333C11.3807 10.8333 12.5 9.71405 12.5 8.33333C12.5 6.95262 11.3807 5.83333 10 5.83333C8.61929 5.83333 7.5 6.95262 7.5 8.33333C7.5 9.71405 8.61929 10.8333 10 10.8333Z"/>
            </svg>
            <span>Tracking</span>
        </a>
    </div>

    <!-- jQuery -->
    <script src="assets/js/jquery-2.1.0.min.js"></script>

    <!-- Bootstrap -->
    <script src="assets/js/popper.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- Plugins -->
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/accordions.js"></script>
    <script src="assets/js/datepicker.js"></script>
    <script src="assets/js/scrollreveal.min.js"></script>
    <script src="assets/js/waypoints.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/imgfix.min.js"></script> 
    <script src="assets/js/slick.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>
    <script src="assets/js/isotope.js"></script> 
    
    <!-- Global Init -->
    <script src="assets/js/custom.js"></script>

    <script>
    // API Base URL
    const API_BASE = '/api';

    // Validate Algerian phone number format
    function validatePhoneNumber(phone) {
        const phoneRegex = /^(\+213|0)[5-7][0-9]{8}$/;
        const cleanPhone = phone.replace(/\s+/g, '');
        return phoneRegex.test(cleanPhone);
    }

    // Sanitize input to prevent XSS
    function sanitizeInput(input) {
        if (typeof input !== 'string') return input;
        const div = document.createElement('div');
        div.textContent = input;
        return div.innerHTML;
    }

    // Show alert message
    function showAlert(message, type = 'success') {
        const alertElement = document.getElementById('alert-message');
        alertElement.textContent = sanitizeInput(message);
        alertElement.className = `alert-message alert-${type}`;
        alertElement.style.display = 'block';
        
        setTimeout(() => {
            alertElement.style.display = 'none';
        }, 5000);
    }

    // Show loading state for track button
    function showLoading() {
        const button = document.getElementById('track-order-btn');
        const buttonText = document.getElementById('track-button-text');
        const spinner = document.getElementById('track-button-spinner');
        
        button.disabled = true;
        buttonText.textContent = 'Loading...';
        spinner.style.display = 'inline-block';
    }

    // Hide loading state for track button
    function hideLoading() {
        const button = document.getElementById('track-order-btn');
        const buttonText = document.getElementById('track-button-text');
        const spinner = document.getElementById('track-button-spinner');
        
        button.disabled = false;
        buttonText.textContent = 'Track Order';
        spinner.style.display = 'none';
    }

    // Fetch orders from backend API
    async function fetchOrdersByPhone(phoneNumber) {
        try {
            const response = await fetch(`${API_BASE}/orders/phone/${encodeURIComponent(phoneNumber)}`);
            if (!response.ok) {
                if (response.status === 404) {
                    return []; // No orders found
                }
                throw new Error('Failed to fetch orders');
            }
            return await response.json();
        } catch (error) {
            console.error('Error fetching orders:', error);
            throw error;
        }
    }

    // Check if input is admin access code and redirect to admin
async function checkAdminAccessCode(inputValue) {
    try {
        const response = await fetch(`${API_BASE}/admin/validate-admin-code`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ code: inputValue })
        });
        
        if (response.ok) {
            const result = await response.json();
            if (result.valid) {
                return true;
            }
        }
        return false;
    } catch (error) {
        console.error('Error validating admin code:', error);
        return false;
    }
}

    // Redirect to admin page
    function redirectToAdmin() {
        showAlert('Admin access granted! Redirecting to admin panel...', 'success');
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 1500);
    }

    // Format date for display
    function formatDate(dateString) {
        try {
            const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        } catch (error) {
            return 'Invalid date';
        }
    }

    // Format currency for display
    function formatCurrency(amount) {
        if (isNaN(amount)) return 'DA 0';
        return `DA ${amount.toLocaleString()}`;
    }

    // Get status display text and class
    function getStatusInfo(status) {
        const statusMap = {
            'pending': { text: 'Pending', class: 'status-pending' },
            'confirmed': { text: 'Confirmed', class: 'status-confirmed' },
            'shipped': { text: 'Shipped', class: 'status-shipped' },
            'delivered': { text: 'Delivered', class: 'status-delivered' }
        };
        return statusMap[status] || { text: 'Unknown', class: 'status-pending' };
    }

    // Get the current step in the tracking process based on status
    function getCurrentStep(status) {
        const steps = ['pending', 'confirmed', 'shipped', 'delivered'];
        return Math.max(0, steps.indexOf(status));
    }

    // Toggle order card expansion
    function toggleOrderCard(cardElement) {
        cardElement.classList.toggle('expanded');
    }

    // Load and display orders for a phone number
    async function loadOrders(phoneNumber) {
        const ordersContainer = document.getElementById('orders-container');
        
        try {
            const orders = await fetchOrdersByPhone(phoneNumber);
            
            if (orders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="no-orders">
                        <i class="fa fa-search"></i>
                        <h3>No Orders Found</h3>
                        <p>No orders found for phone number: ${sanitizeInput(phoneNumber)}. Please check the number and try again.</p>
                    </div>
                `;
                return;
            }
            
            let ordersHTML = '';
            
            orders.forEach(order => {
                const statusInfo = getStatusInfo(order.status);
                
                ordersHTML += `
                    <div class="order-card">
                        <div class="order-header" onclick="toggleOrderCard(this.parentElement)">
                            <div class="order-header-content">
                                <div class="order-id">Order #${sanitizeInput(order.orderId)}</div>
                                <div class="order-date">Placed on ${formatDate(order.createdAt)} by ${sanitizeInput(order.customerName)}</div>
                                <div class="order-status ${statusInfo.class}">${statusInfo.text}</div>
                            </div>
                            <div class="expand-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="order-body">
                            ${generateOrderBody(order)}
                        </div>
                    </div>
                `;
            });
            
            ordersContainer.innerHTML = ordersHTML;
            showAlert(`Found ${orders.length} order(s) for ${sanitizeInput(phoneNumber)}`, 'success');
            
        } catch (error) {
            ordersContainer.innerHTML = `
                <div class="no-orders">
                    <i class="fa fa-exclamation-triangle"></i>
                    <h3>Error Loading Orders</h3>
                    <p>${sanitizeInput(error.message || 'There was an error loading orders. Please try again.')}</p>
                </div>
            `;
            showAlert(error.message || 'Error loading orders. Please try again.', 'error');
        }
    }

    // Generate the expanded order body content
    function generateOrderBody(order) {
        const statusInfo = getStatusInfo(order.status);
        const currentStep = getCurrentStep(order.status);
        
        // Build tracking timeline
        let trackingHTML = '';
        const trackingSteps = [
            { status: 'pending', label: 'Order Received', message: 'Your order has been received and is being processed' },
            { status: 'confirmed', label: 'Order Confirmed', message: 'Your order has been confirmed and is being prepared' },
            { status: 'shipped', label: 'Order Shipped', message: 'Your order has been shipped and is on its way' },
            { status: 'delivered', label: 'Order Delivered', message: 'Your order has been delivered successfully' }
        ];
        
        // Get delivery updates or create default ones
        const deliveryUpdates = order.deliveryUpdates && order.deliveryUpdates.length > 0 
            ? order.deliveryUpdates 
            : [];
        
        trackingSteps.forEach((step, index) => {
            const update = deliveryUpdates.find(u => u.status === step.status);
            const isCompleted = index <= currentStep;
            const isActive = index === currentStep;
            
            let stepClass = '';
            if (isCompleted) stepClass += ' completed';
            if (isActive) stepClass += ' active';
            
            const updateDate = update ? update.date : (isCompleted ? order.createdAt : '');
            const message = update ? update.message : (isCompleted ? step.message : 'Pending');
            
            trackingHTML += `
                <div class="tracking-step${stepClass}">
                    <div class="tracking-date">${updateDate ? formatDate(updateDate) : ''}</div>
                    <div class="tracking-status">${step.label}</div>
                    <div class="tracking-message">${sanitizeInput(message)}</div>
                </div>
            `;
        });
        
        // Build order items HTML
        let itemsHTML = '';
        if (order.items && order.items.length > 0) {
            order.items.forEach(item => {
                // NEW: Show selected color if available
                const colorInfo = item.selected_color ? `<div class="item-details">Color: ${sanitizeInput(item.selected_color)}</div>` : '';
                
                itemsHTML += `
                    <div class="order-item">
                        <div>
                            <div class="item-name">${sanitizeInput(item.name || 'Unknown Item')}</div>
                            <div class="item-details">Qty: ${item.quantity}</div>
                            ${colorInfo}
                        </div>
                        <div class="item-price">${formatCurrency((item.price || 0) * (item.quantity || 1))}</div>
                    </div>
                `;
            });
        } else {
            itemsHTML = '<div class="text-muted">No items found in this order</div>';
        }
        
        return `
            <div class="order-details">
                <div class="detail-group">
                    <h4>Customer Information</h4>
                    <p><strong>Name:</strong> ${sanitizeInput(order.customerName || 'N/A')}</p>
                    <p><strong>Phone:</strong> ${sanitizeInput(order.phoneNumber || 'N/A')}</p>
                </div>
                <div class="detail-group">
                    <h4>Shipping Address</h4>
                    <p><strong>Address:</strong> ${sanitizeInput(order.address || 'N/A')}</p>
                    <p><strong>Wilaya:</strong> ${sanitizeInput(order.wilaya || 'N/A')}</p>
                </div>
            </div>
            
            <div class="order-items">
                <h4>Order Items</h4>
                ${itemsHTML}
                <div class="order-total">Total: ${formatCurrency(order.total || 0)}</div>
            </div>
            
            <h4 class="tracking-section-title">Order Tracking</h4>
            <div class="tracking-timeline">
                ${trackingHTML}
            </div>
        `;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Tracking page loaded');
        
        // Add event listener to track order button
document.getElementById('track-order-btn').addEventListener('click', async function() {
    const phoneInput = document.getElementById('phone-input');
    const inputValue = phoneInput.value.trim();
    
    if (!inputValue) {
        showAlert('Please enter your phone number.', 'error');
        return;
    }

    // Input length validation
    if (inputValue.length > 100) {  // ← MAKE SURE THIS IS 100, NOT 50
        showAlert('Input too long. Please check your phone number.', 'error');
        return;
    }
            
            showLoading();
            
            try {
                // Check if input is an admin access code
                const isAdminCode = await checkAdminAccessCode(inputValue);
                if (isAdminCode) {
                    redirectToAdmin();
                    return;
                }
                
                // Validate phone number format
                const cleanPhone = inputValue.replace(/\s+/g, '');
                
                if (!validatePhoneNumber(cleanPhone)) {
                    showAlert('Please enter a valid Algerian phone number (e.g., +213 XX XX XX XXX or 0X XX XX XX XX)', 'error');
                    return;
                }
                
                // Load orders for this phone number
                await loadOrders(cleanPhone);
                
            } catch (error) {
                console.error('Error processing request:', error);
                showAlert('An error occurred. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        });
        
        // Allow pressing Enter to submit
        document.getElementById('phone-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('track-order-btn').click();
            }
        });

        // Add menu trigger logic for bottom nav
        $('.menu-trigger-bottom').click(function(e) {
            e.preventDefault();
            $('.header-area .menu-trigger').trigger('click');
        });
    });
    </script>

</body>

</html>